<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Unsupervised clustering of SpatRaster data using kmeans clustering"><title>Unsupervised Classification — unsuperClass • RStoolbox</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.11/clipboard.min.js" integrity="sha512-7O5pXpc0oCRrxk8RUfDYFgn0nO1t+jLuIOQdOMRp4APB7uZ4vSjspzp5y6YDtDs4VzUSTbWzBFZ/LKJhnyFOKw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Unsupervised Classification — unsuperClass"><meta property="og:description" content="Unsupervised clustering of SpatRaster data using kmeans clustering"><meta property="og:image" content="https://bleutner.github.io/RStoolbox/logo.png"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light" data-bs-theme="light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">RStoolbox</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item">
  <a class="nav-link" href="../news/index.html">News</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Functions</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="http://www.github.com/bleutner">
    <span class="fa fa-github fa-lg fab"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Unsupervised Classification</h1>
      <small class="dont-index">Source: <a href="https://github.com/bleutner/RStoolbox/blob/HEAD/R/unsuperClass.R" class="external-link"><code>R/unsuperClass.R</code></a></small>
      <div class="d-none name"><code>unsuperClass.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Unsupervised clustering of SpatRaster data using kmeans clustering</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">unsuperClass</span><span class="op">(</span></span>
<span>  <span class="va">img</span>,</span>
<span>  nSamples <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  nClasses <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  nStarts <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  nIter <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  norm <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  clusterMap <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  algorithm <span class="op">=</span> <span class="st">"Hartigan-Wong"</span>,</span>
<span>  output <span class="op">=</span> <span class="st">"classes"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>img</dt>
<dd><p>SpatRaster.</p></dd>


<dt>nSamples</dt>
<dd><p>Integer. Number of random samples to draw to fit cluster map. Only relevant if clusterMap = TRUE.</p></dd>


<dt>nClasses</dt>
<dd><p>Integer. Number of classes.</p></dd>


<dt>nStarts</dt>
<dd><p>Integer. Number of random starts for kmeans algorithm.</p></dd>


<dt>nIter</dt>
<dd><p>Integer. Maximal number of iterations allowed.</p></dd>


<dt>norm</dt>
<dd><p>Logical. If <code>TRUE</code> will normalize img first using <a href="normImage.html">normImage</a>. Normalizing is beneficial if your predictors have different scales.</p></dd>


<dt>clusterMap</dt>
<dd><p>Logical. Fit kmeans model to a random subset of the img (see Details).</p></dd>


<dt>algorithm</dt>
<dd><p>Character. <a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a> algorithm. One of c("Hartigan-Wong", "Lloyd", "MacQueen")</p></dd>


<dt>output</dt>
<dd><p>Character. Either 'classes' (kmeans class; default) or 'distances' (euclidean distance to each cluster center).</p></dd>


<dt>...</dt>
<dd><p>further arguments to be passed to <a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a>, e.g. filename</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>Returns an RStoolbox::unsuperClass object, which is a list containing the kmeans model ($model) and the raster map ($map).
For output = "classes", $map contains a SpatRaster with discrete classes (kmeans clusters); for output = "distances" $map contains
a SpatRaster, with `nClasses` layers, where each layer maps the euclidean distance to the corresponding class centroid.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Clustering is done using <code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">kmeans</a></code>. This can be done for all pixels of the image (<code>clusterMap=FALSE</code>), however this can be slow and is
not memory safe. Therefore if you have large raster data (&gt; memory), as is typically the case with remote sensing imagery it is advisable to choose clusterMap=TRUE (the default).
This means that a kmeans cluster model is calculated based on a random subset of pixels (<code>nSamples</code>). Then the distance of *all* pixels to the cluster centers 
is calculated in a stepwise fashion using <code><a href="https://rspatial.github.io/terra/reference/predict.html" class="external-link">predict</a></code>. Class assignment is based on minimum euclidean distance to the cluster centers.</p>
<p>The solution of the kmeans algorithm often depends on the initial configuration of class centers which is chosen randomly. 
Therefore, kmeans is usually run with multiple random starting configurations in order to find a convergent solution from different starting configurations.
The <code>nStarts</code> argument allows to specify how many random starts are conducted.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">input</span> <span class="op">&lt;-</span> <span class="va">rlogo</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plot </span></span></span>
<span class="r-in"><span><span class="va">olpar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>no.readonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># back-up par</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Run classification</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unC</span> <span class="op">&lt;-</span> <span class="fu">unsuperClass</span><span class="op">(</span><span class="va">input</span>, nSamples <span class="op">=</span> <span class="fl">100</span>, nClasses <span class="op">=</span> <span class="fl">5</span>, nStarts <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unC</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Plots</span></span></span>
<span class="r-in"><span><span class="va">colors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">unC</span><span class="op">$</span><span class="va">map</span>, col <span class="op">=</span> <span class="va">colors</span>, legend <span class="op">=</span> <span class="cn">FALSE</span>, axes <span class="op">=</span> <span class="cn">FALSE</span>, box <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"C"</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">colors</span>, title <span class="op">=</span> <span class="st">"Classes"</span>, horiz <span class="op">=</span> <span class="cn">TRUE</span>,  bty <span class="op">=</span> <span class="st">"n"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Return the distance of each pixel to each class centroid</span></span></span>
<span class="r-in"><span><span class="va">unC</span> <span class="op">&lt;-</span> <span class="fu">unsuperClass</span><span class="op">(</span><span class="va">input</span>, nSamples <span class="op">=</span> <span class="fl">100</span>, nClasses <span class="op">=</span> <span class="fl">3</span>, output <span class="op">=</span> <span class="st">"distances"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">unC</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="ggR.html">ggR</a></span><span class="op">(</span><span class="va">unC</span><span class="op">$</span><span class="va">map</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, geom_raster <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span><span class="va">olpar</span><span class="op">)</span> <span class="co"># reset par</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Benjamin Leutner, Ned Horning, Jakob Schwalb-Willmann, Konstantin Mueller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

    </footer></div>

  

  

  </body></html>

