<!DOCTYPE html><html><head><title>R: Spectral Angle Mapper</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.css">
<script type="text/javascript">
const macros = { "\\R": "\\textsf{R}", "\\code": "\\texttt"};
function processMathHTML() {
    var l = document.getElementsByClassName('reqn');
    for (let e of l) { katex.render(e.textContent, e, { throwOnError: false, macros }); }
    return;
}</script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.3/dist/katex.min.js"
    onload="processMathHTML();"></script>
<link rel="stylesheet" type="text/css" href="R.css" />

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/styles/github.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/highlight.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.3/languages/r.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head><body><div class="container">

<table style="width: 100%;"><tr><td>sam {RStoolbox}</td><td style="text-align: right;">R Documentation</td></tr></table>

<h2>Spectral Angle Mapper</h2>

<h3>Description</h3>

<p>Calculates the angle in spectral space between pixels and a set of reference spectra (endmembers) for image classification based on spectral similarity.
</p>


<h3>Usage</h3>

<pre><code class='language-R'>sam(img, em, angles = FALSE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;"><td><code>img</code></td>
<td>
<p>RasterBrick or RasterStack or SpatRaster. Remote sensing imagery.</p>
</td></tr>
<tr style="vertical-align: top;"><td><code>em</code></td>
<td>
<p>Matrix or data.frame with endmembers. Each row should contain the endmember spectrum of a class, i.e. columns correspond to bands in <code>img</code>. It is reccomended to set the rownames to class names.</p>
</td></tr>
<tr style="vertical-align: top;"><td><code>angles</code></td>
<td>
<p>Logical. If <code>TRUE</code> a RasterBrick containing each one layer per endmember will be returned containing the spectral angles.</p>
</td></tr>
<tr style="vertical-align: top;"><td><code>...</code></td>
<td>
<p>further arguments to be passed to <code><a href="../../terra/help/writeRaster.html">writeRaster</a></code></p>
</td></tr>
</table>


<h3>Details</h3>

<p>For each pixel the spectral angle mapper calculates the angle between the vector defined by the pixel values and each endmember vector. The result of this is
one raster layer for each endmember containing the spectral angle. The smaller the spectral angle the more similar a pixel is to a given endmember class.
In a second step one can the go ahead an enforce thresholds of maximum angles or simply classify each pixel to the most similar endmember.
</p>


<h3>Value</h3>

<p>SpatRaster
If <code>angles = FALSE</code> a single Layer will be returned in which each pixel is assigned to the closest endmember class (integer pixel values correspond to row order of <code>em</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-r">library(terra)
library(ggplot2)

## Sample endmember spectra
## First location is water, second is open agricultural vegetation
pts &lt;- data.frame(x = c(624720, 627480), y = c(-414690, -411090))
endmembers &lt;- extract(lsat, pts)
rownames(endmembers) &lt;- c(&quot;water&quot;, &quot;vegetation&quot;)
</code></pre>
<pre><code>#&gt; Error in `rownames&lt;-`(`*tmp*`, value = c(&quot;water&quot;, &quot;vegetation&quot;)): attempt to set 'rownames' on an object with no dimensions
</code></pre>
<pre><code class="language-r">## Calculate spectral angles
lsat_sam &lt;- sam(lsat, endmembers, angles = TRUE)
</code></pre>
<pre><code>#&gt; Error in sam(lsat, endmembers, angles = TRUE): The number of columns in em must match the number of bands in x.
</code></pre>
<pre><code class="language-r">plot(lsat_sam)
</code></pre>
<pre><code>#&gt; Error in h(simpleError(msg, call)): error in evaluating the argument 'x' in selecting a method for function 'plot': object 'lsat_sam' not found
</code></pre>
<pre><code class="language-r">## Classify based on minimum angle
lsat_sam &lt;- sam(lsat, endmembers, angles = FALSE)
</code></pre>
<pre><code>#&gt; Error in sam(lsat, endmembers, angles = FALSE): The number of columns in em must match the number of bands in x.
</code></pre>
<pre><code class="language-r">ggR(lsat_sam, forceCat = TRUE, geom_raster=TRUE) +
             scale_fill_manual(values = c(&quot;blue&quot;, &quot;green&quot;), labels = c(&quot;water&quot;, &quot;vegetation&quot;))
</code></pre>
<pre><code>#&gt; Error in .toTerra(img): object 'lsat_sam' not found
</code></pre>


<hr /><div style="text-align: center;">[Package <em>RStoolbox</em> version 0.4.0 <a href="00Index.html">Index</a>]</div>
</div>
</body></html>
